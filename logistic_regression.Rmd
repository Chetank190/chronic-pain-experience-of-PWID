---
title: "R Notebook"
output:
  pdf_document: default
  html_document:
    df_print: paged
---
# Load libraries

```{r, warning=FALSE, message = FALSE}
library(readxl)
library(rstatix)
library(data.table)
library(chisq.posthoc.test)
library(dplyr)
options(dplyr.summarise.inform = FALSE)
```

# Load Data

```{r, warning=FALSE}
data <- read_excel("pain_v_3_first_1_add_Nov 22 2022 request.xlsx")
```

# Data Cleaning


## Removing rows where pain is due to cancer

```{r}
# Remove rows where pain is due to cancer

data <- data[-which(data$DrQ6_Cancer == -1),]

dim(data)
```

## Cleaning and analyzing response variable

```{r}
# Setting response variable: 0: No chronic pain (left blank), 1 - having chronic pain (some response available)
data$DrQ3 <- ifelse(is.na(data$DrQ3), "No", "Yes")
data$DrQ3 <- as.factor(data$DrQ3)
# Creating table
table(data$DrQ3, useNA = "always")
```
As you can see from the above table, 291 people do not suffer from chronic pain, while 250 suffer from chronic pain. In this table, there are no null values.

## Cleaning and analyzing explanatory variable






```{r}
# Changing date of birth to age

# Created a new feature called age from birthd_bs
data$age <- as.numeric(difftime(Sys.Date(),data$birthd_bs, units = "weeks"))/52.25


# Unstable housing (1=yes, 0=no)
data$unstabh_1mb <- as.factor(data$unstabh_1mb)
unique(data$unstabh_1mb)
table(data$unstabh_1mb, useNA = "always")
data$unstabh_1mb[is.na(data$unstabh_1mb)] <- 0


# incar_3m (incarceration past month) (1=yes, 0=no)
data$incar_3m <- as.factor(data$incar_3m)
unique(data$incar_3m)
table(data$incar_3m, useNA = "always")


# education CO_scolar (values: 0 to 9)
data$CO_scolar <- as.factor(data$CO_scolar)
unique(data$CO_scolar)
table(data$CO_scolar, useNA = "always")


# OAT_3m : OAT past 3 months (1=yes, 0=no)
data$OAT_3m <- as.factor(data$OAT_3m)
unique(data$OAT_3m)
table(data$OAT_3m, useNA = "always")


# cocaiv_pm (iv cocaine use past month) (1=yes, 0=no)
data$cocaiv_pm <- as.factor(data$cocaiv_pm)
unique(data$cocaiv_pm)
table(data$cocaiv_pm, useNA = "always")


# heroiv_pm (iv heroine use past month) (1=yes, 0=no)
data$heroiv_pm <- as.factor(data$heroiv_pm)
unique(data$heroiv_pm)
table(data$heroiv_pm, useNA = "always")

# opiiv_pm (iv opioid use past month) (1=yes, 0=no)
data$opiiv_pm <- as.factor(data$opiiv_pm)
unique(data$opiiv_pm)
table(data$opiiv_pm, useNA = "always")

# Gender (1 Male, 2 Female, 3 Other)
unique(data$VBA3)
# Removing others as there frequency is less than 5
data <- data[-which(data$VBA3 == 3),]
data$VBA3 <- as.factor(data$VBA3)
table(data$VBA3, useNA = "always")


# NW_jourcons (how many days in total have you consumed all substances listed above in last month)
unique(data$NW_jourcons)
table(data$NW_jourcons, useNA = "always")

# CO_njalc1 (how many days in last month did you consume alcohol)
unique(data$CO_njalc1)
table(data$CO_njalc1, useNA = "always")

# CO_ihero1m (in last month did you inject heroin)
unique(data$CO_ihero1m)
table(data$CO_ihero1m, useNA = "always")

# Q22AJ (how many days)
unique(data$Q22AJ)
table(data$Q22AJ, useNA = "always")
data$Q22AJ[is.na(data$Q22AJ)] <- 0

# COMD_nihero1m (on average how many times per day)
unique(data$COMD_nihero1m)
table(data$COMD_nihero1m, useNA = "always")
data$COMD_nihero1m[is.na(data$COMD_nihero1m)] <- 0


# COMD_fshero1m (in last month did you sniff heroin)
unique(data$COMD_fshero1m)
table(data$COMD_fshero1m, useNA = "always")

# Q22BJ (how many days)
unique(data$Q22BJ)
table(data$Q22BJ, useNA = "always")
data$Q22BJ[is.na(data$Q22BJ)] <- 0

# COMD_nfshero1m (how many times per day)
unique(data$COMD_nfshero1m)
table(data$COMD_nfshero1m, useNA = "always")
data$COMD_nfshero1m[is.na(data$COMD_nfshero1m)] <- 0

# CO_ipoud1m (in last month did you inject powdered cocaine)
unique(data$CO_ipoud1m)
table(data$CO_ipoud1m, useNA = "always")

# MD_Q23AJ_1 (how many days)
unique(data$MD_Q23AJ_1)
table(data$MD_Q23AJ_1, useNA = "always")
data$MD_Q23AJ_1[is.na(data$MD_Q23AJ_1)] <- 0


# COMD_nicoke1m_p (how many times per day)
unique(data$COMD_nicoke1m_p)
table(data$COMD_nicoke1m_p, useNA = "always")
data$COMD_nicoke1m_p[is.na(data$COMD_nicoke1m_p)] <- 0


# CO_icrak1m (in last month did you inject crack) (1=yes 2=no)
unique(data$CO_icrak1m)
table(data$CO_icrak1m, useNA = "always")
data$CO_icrak1m <- as.factor(data$CO_icrak1m)


# MD_Q23AJ_2 (how many days)
unique(data$MD_Q23AJ_2)
table(data$MD_Q23AJ_2, useNA = "always")
data$MD_Q23AJ_2[is.na(data$MD_Q23AJ_2)] <- 0

# COMD_nicoke1m_c (how many times per day) (1= 1-3, 2= 4-6, 3= 6+)
unique(data$COMD_nicoke1m_c)
table(data$COMD_nicoke1m_c, useNA = "always")
data$COMD_nicoke1m_c[is.na(data$COMD_nicoke1m_c)] <- 0
data$COMD_nicoke1m_c <- as.factor(data$COMD_nicoke1m_c)

# CO_fpoud1m (in last month did you smoke cocaine powder) (1=yes 2=no)
unique(data$CO_fpoud1m)
table(data$CO_fpoud1m, useNA = "always")
data$CO_fpoud1m <- as.factor(data$CO_fpoud1m)

# MD_Q23BJ_1 (how many days)
unique(data$MD_Q23BJ_1)
table(data$MD_Q23BJ_1, useNA = "always")
data$MD_Q23BJ_1[is.na(data$MD_Q23BJ_1)] <- 0

# COMD_nfcoke1m_p (how many times per day) (1= 1-3, 2= 4-6, 3= 6+)
unique(data$COMD_nfcoke1m_p)
table(data$COMD_nfcoke1m_p, useNA = "always")
data$COMD_nfcoke1m_p[is.na(data$COMD_nfcoke1m_p)] <- 0
data$COMD_nfcoke1m_p <- as.factor(data$COMD_nfcoke1m_p)

# COMD_fcrakfree1m (1=yes 2=no)
unique(data$COMD_fcrakfree1m)
table(data$COMD_fcrakfree1m, useNA = "always")
data$COMD_fcrakfree1m[is.na(data$COMD_fcrakfree1m)] <- 0
data$COMD_fcrakfree1m <- as.factor(data$COMD_fcrakfree1m)

# MD_Q23BJ_2
unique(data$MD_Q23BJ_2)
table(data$MD_Q23BJ_2, useNA = "always")
data$MD_Q23BJ_2[is.na(data$MD_Q23BJ_2)] <- 0

# COMD_nfcoke1m_cf (1= 1-3, 2= 4-6, 3= 6+)
unique(data$COMD_nfcoke1m_cf)
table(data$COMD_nfcoke1m_cf, useNA = "always")
data$COMD_nfcoke1m_cf[is.na(data$COMD_nfcoke1m_cf)] <- 0
data$COMD_nfcoke1m_cf <- as.factor(data$COMD_nfcoke1m_cf)

# CO_scoke1m (1=yes 2=no)
unique(data$CO_scoke1m)
table(data$CO_scoke1m, useNA = "always")
data$CO_scoke1m <- as.factor(data$CO_scoke1m)

# Q23CJ
unique(data$Q23CJ)
table(data$Q23CJ, useNA = "always")
data$Q23CJ[is.na(data$Q23CJ)] <- 0

# COMD_nscoke1m (how many times per day) (1= 1-3, 2= 4-6, 3= 6+)
unique(data$COMD_nscoke1m)
table(data$COMD_nscoke1m, useNA = "always")
data$COMD_nscoke1m[is.na(data$COMD_nscoke1m)] <- 0
data$COMD_nscoke1m <- as.factor(data$COMD_nscoke1m)

# CO_ispeed1m (1=yes 2=no)
unique(data$CO_ispeed1m)
table(data$CO_ispeed1m, useNA = "always")
data$CO_ispeed1m <- as.factor(data$CO_ispeed1m)

# Q2223AJ
unique(data$Q2223AJ)
table(data$Q2223AJ, useNA = "always")
data$Q2223AJ[is.na(data$Q2223AJ)] <- 0

# COMD_nispeed1m (1= 1-3, 2= 4-6, 3= 6+)
unique(data$COMD_nispeed1m)
table(data$COMD_nispeed1m, useNA = "always")
data$COMD_nispeed1m[is.na(data$COMD_nispeed1m)] <- 0
data$COMD_nispeed1m <- as.factor(data$COMD_nispeed1m)

# NH_Q7Ia_suboxIV
unique(data$NH_Q7Ia_suboxIV)
table(data$NH_Q7Ia_suboxIV, useNA = "always")
data$NH_Q7Ia_suboxIV[is.na(data$NH_Q7Ia_suboxIV)] <- 2
data$NH_Q7Ia_suboxIV <- as.factor(data$NH_Q7Ia_suboxIV)


# NH_Q7Ia_suboxIVj
unique(data$NH_Q7Ia_suboxIVj)
table(data$NH_Q7Ia_suboxIVj, useNA = "always")
data$NH_Q7Ia_suboxIVj[is.na(data$NH_Q7Ia_suboxIVj)] <- 2

# NH_Q7Ib_subox
unique(data$NH_Q7Ib_subox)
table(data$NH_Q7Ib_subox, useNA = "always")
data$NH_Q7Ib_subox[is.na(data$NH_Q7Ib_subox)] <- 2
data$NH_Q7Ib_subox <- as.factor(data$NH_Q7Ib_subox)

# NH_Q7Ib_suboxj
unique(data$NH_Q7Ib_suboxj)
table(data$NH_Q7Ib_suboxj, useNA = "always")
data$NH_Q7Ib_suboxj[is.na(data$NH_Q7Ib_suboxj)] <- 0

# NH_Q7Ja_methaIV
unique(data$NH_Q7Ja_methaIV)
table(data$NH_Q7Ja_methaIV, useNA = "always")
data$NH_Q7Ja_methaIV[is.na(data$NH_Q7Ja_methaIV)] <- 2
data$NH_Q7Ja_methaIV <- as.factor(data$NH_Q7Ja_methaIV)

# NH_Q7Ja_methaIVj
unique(data$NH_Q7Ja_methaIVj)
table(data$NH_Q7Ja_methaIVj, useNA = "always")
data$NH_Q7Ja_methaIVj[is.na(data$NH_Q7Ja_methaIVj)] <- 0

# NH_Q7Jb_metha
unique(data$NH_Q7Jb_metha)
table(data$NH_Q7Jb_metha, useNA = "always")
data$NH_Q7Jb_metha[is.na(data$NH_Q7Jb_metha)] <- 2
data$NH_Q7Jb_metha <- as.factor(data$NH_Q7Jb_metha)

# NH_Q7Jb_methaj
unique(data$NH_Q7Jb_methaj)
table(data$NH_Q7Jb_methaj, useNA = "always")
data$NH_Q7Jb_methaj[is.na(data$NH_Q7Jb_methaj)] <- 0

# CO_iopiac1m (1=yes 2=no)
unique(data$CO_iopiac1m)
table(data$CO_iopiac1m, useNA = "always")
data$CO_iopiac1m <- as.factor(data$CO_iopiac1m)


# Q26BJ
unique(data$Q26BJ)
table(data$Q26BJ, useNA = "always")
data$Q26BJ[is.na(data$Q26BJ)] <- 0

# CO_niopiac1m (1= 1-3, 2= 4-6, 3= 6+)
unique(data$CO_niopiac1m)
table(data$CO_niopiac1m, useNA = "always")
data$CO_niopiac1m[is.na(data$CO_niopiac1m)] <- 0
data$CO_niopiac1m <- as.factor(data$CO_niopiac1m)

# CO_autopiac1m
unique(data$CO_autopiac1m)
table(data$CO_autopiac1m, useNA = "always")
data$CO_autopiac1m <- as.factor(data$CO_autopiac1m)

# Q26AJ
unique(data$Q26AJ)
table(data$Q26AJ, useNA = "always")
data$Q26AJ[is.na(data$Q26AJ)] <- 0

# NH_Q26AJnf (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NH_Q26AJnf)
table(data$NH_Q26AJnf, useNA = "always")
data$NH_Q26AJnf[is.na(data$NH_Q26AJnf)] <- 0
data$NH_Q26AJnf <- as.factor(data$NH_Q26AJnf)

# NMD_CO_iamph1m
unique(data$NMD_CO_iamph1m)
table(data$NMD_CO_iamph1m, useNA = "always")
data$NMD_CO_iamph1m <- as.factor(data$NMD_CO_iamph1m)

# NMD_Q27BJ
unique(data$NMD_Q27BJ)
table(data$NMD_Q27BJ, useNA = "always")
data$NMD_Q27BJ[is.na(data$NMD_Q27BJ)] <- 0


# NMD_CO_niamph1m (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NMD_CO_niamph1m)
table(data$NMD_CO_niamph1m, useNA = "always")
data$NMD_CO_niamph1m[is.na(data$NMD_CO_niamph1m)] <- 0
data$NMD_CO_niamph1m <- as.factor(data$NMD_CO_niamph1m)

# NMD_COMD_fsautamph1m
unique(data$NMD_COMD_fsautamph1m)
table(data$NMD_COMD_fsautamph1m, useNA = "always")
data$NMD_COMD_fsautamph1m <- as.factor(data$NMD_COMD_fsautamph1m)

# NMD_Q27AJ
unique(data$NMD_Q27AJ)
table(data$NMD_Q27AJ, useNA = "always")
data$NMD_Q27AJ[is.na(data$NMD_Q27AJ)] <- 0

# NMD_COMD_nfsaamph1m (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NMD_COMD_nfsaamph1m)
table(data$NMD_COMD_nfsaamph1m, useNA = "always")
data$NMD_COMD_nfsaamph1m[is.na(data$NMD_COMD_nfsaamph1m)] <- 0
data$NMD_COMD_nfsaamph1m <- as.factor(data$NMD_COMD_nfsaamph1m)


# NW_tranquiliv1m (1=yes 2=no)
unique(data$NW_tranquiliv1m)
table(data$NW_tranquiliv1m, useNA = "always")
data$NW_tranquiliv1m <- as.factor(data$NW_tranquiliv1m)

# NW_Q29BJ
unique(data$NW_Q29BJ)
table(data$NW_Q29BJ, useNA = "always")
data$NW_Q29BJ[is.na(data$NW_Q29BJ)] <- 0

# NW_tranquiliv1m_fj (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NW_tranquiliv1m_fj)
table(data$NW_tranquiliv1m_fj, useNA = "always")
data$NW_tranquiliv1m_fj[is.na(data$NW_tranquiliv1m_fj)] <- 0
data$NW_tranquiliv1m_fj <- as.factor(data$NW_tranquiliv1m_fj)

# NW_tranquil1m
unique(data$NW_tranquil1m)
table(data$NW_tranquil1m, useNA = "always")
data$NW_tranquil1m <- as.factor(data$NW_tranquil1m)

# Q29AJ
unique(data$Q29AJ)
table(data$Q29AJ, useNA = "always")
data$Q29AJ[is.na(data$Q29AJ)] <- 0

# NW_tranquil1m_fj (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NW_tranquil1m_fj)
table(data$NW_tranquil1m_fj, useNA = "always")
data$NW_tranquil1m_fj[is.na(data$NW_tranquil1m_fj)] <- 0
data$NW_tranquil1m_fj <- as.factor(data$NW_tranquil1m_fj)

# CO_mari1m
unique(data$CO_mari1m)
table(data$CO_mari1m, useNA = "always")
data$CO_mari1m <- as.factor(data$CO_mari1m)

# Q30AJ
unique(data$Q30AJ)
table(data$Q30AJ, useNA = "always")
data$Q30AJ[is.na(data$Q30AJ)] <- 0

# NW_mari1m_fj (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NW_mari1m_fj)
table(data$NW_mari1m_fj, useNA = "always")
data$NW_mari1m_fj[is.na(data$NW_mari1m_fj)] <- 0
data$NW_mari1m_fj <- as.factor(data$NW_mari1m_fj)

# NW_psychiv1m (1=yes 2=no)
unique(data$NW_psychiv1m)
table(data$NW_psychiv1m, useNA = "always")
data$NW_psychiv1m <- as.factor(data$NW_psychiv1m)


# NW_Q31BJ
unique(data$NW_Q31BJ)
table(data$NW_Q31BJ, useNA = "always")
data$NW_Q31BJ[is.na(data$NW_Q31BJ)] <- 0

# NW_psychiv1m_fj
unique(data$NW_psychiv1m_fj)
table(data$NW_psychiv1m_fj, useNA = "always")
data$NW_psychiv1m_fj[is.na(data$NW_psychiv1m_fj)] <- 0
data$NW_psychiv1m_fj <- as.factor(data$NW_psychiv1m_fj)

# NW_psych1m (1=yes 2=no)
unique(data$NW_psych1m)
table(data$NW_psych1m, useNA = "always")
data$NW_psych1m <- as.factor(data$NW_psych1m)

# Q31AJ
unique(data$Q31AJ)
table(data$Q31AJ, useNA = "always")
data$Q31AJ[is.na(data$Q31AJ)] <- 0

# NW_psych1m_fj (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NW_psych1m_fj)
table(data$NW_psych1m_fj, useNA = "always")
data$NW_psych1m_fj[is.na(data$NW_psych1m_fj)] <- 0
data$NW_psych1m_fj <- as.factor(data$NW_psych1m_fj)

# NMD_NW_autmediv1m (1=yes 2=no)
unique(data$NMD_NW_autmediv1m)
table(data$NMD_NW_autmediv1m, useNA = "always")
data$NMD_NW_autmediv1m <- as.factor(data$NMD_NW_autmediv1m)

# NMD_NW_Q32BJ
unique(data$NMD_NW_Q32BJ)
table(data$NMD_NW_Q32BJ, useNA = "always")
data$NMD_NW_Q32BJ[is.na(data$NMD_NW_Q32BJ)] <- 0

# NMD_NW_autmediv1m_fs (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NMD_NW_autmediv1m_fs)
table(data$NMD_NW_autmediv1m_fs, useNA = "always")
data$NMD_NW_autmediv1m_fs[is.na(data$NMD_NW_autmediv1m_fs)] <- 0
data$NMD_NW_autmediv1m_fs <- as.factor(data$NMD_NW_autmediv1m_fs)

# NMD_NW_autmed1m (1=yes 2=no)
unique(data$NMD_NW_autmed1m)
table(data$NMD_NW_autmed1m, useNA = "always")
data$NMD_NW_autmed1m <- as.factor(data$NMD_NW_autmed1m)

# NMD_NW_Q32AJ
unique(data$NMD_NW_Q32AJ)
table(data$NMD_NW_Q32AJ, useNA = "always")
data$NMD_NW_Q32AJ[is.na(data$NMD_NW_Q32AJ)] <- 0


# NMD_NW_autmed1m_fs (1= 1-3, 2= 4-6, 3= 6+)
unique(data$NMD_NW_autmed1m_fs)
table(data$NMD_NW_autmed1m_fs, useNA = "always")
data$NMD_NW_autmed1m_fs[is.na(data$NMD_NW_autmed1m_fs)] <- 0
data$NMD_NW_autmed1m_fs <- as.factor(data$NMD_NW_autmed1m_fs)

# CO_iaut11m (1=yes 2=no)
unique(data$CO_iaut11m)
table(data$CO_iaut11m, useNA = "always")
data$CO_iaut11m <- as.factor(data$CO_iaut11m)

# CO_fsaut11m (1=yes 2=no)
unique(data$CO_fsaut11m)
table(data$CO_fsaut11m, useNA = "always")
data$CO_fsaut11m <- as.factor(data$CO_fsaut11m)


# NW_Q21C1 (1- yes, 2-No)
unique(data$NW_Q21C1)
table(data$NW_Q21C1, useNA = "always")
data$NW_Q21C1 <- as.factor(data$NW_Q21C1)


# age_40 (greater than and equal to 40 = 1,  less than 40 = 0)
data$age_40 <- ifelse(data$age >= 40, 1, 0)
data$age_40 <- as.factor(data$age_40)



new_data <- data %>% select(DrQ3, age, age_40, unstabh_1mb, incar_3m, CO_scolar, OAT_3m, cocaiv_pm, heroiv_pm, opiiv_pm, VBA3, NW_jourcons, CO_njalc1, CO_ihero1m, Q22AJ, COMD_nihero1m, COMD_fshero1m, Q22BJ, COMD_nfshero1m, CO_ipoud1m, MD_Q23AJ_1, COMD_nicoke1m_p,
CO_icrak1m, MD_Q23AJ_2, COMD_nicoke1m_c, CO_fpoud1m, MD_Q23BJ_1, COMD_nfcoke1m_p, COMD_fcrakfree1m, MD_Q23BJ_2, COMD_nfcoke1m_cf, CO_scoke1m, Q23CJ, COMD_nscoke1m, CO_ispeed1m, Q2223AJ, COMD_nispeed1m, NH_Q7Ia_suboxIV, NH_Q7Ia_suboxIVj, NH_Q7Ib_subox, NH_Q7Ib_suboxj, NH_Q7Ja_methaIV, NH_Q7Ja_methaIVj,NH_Q7Jb_metha, NH_Q7Jb_methaj, CO_iopiac1m, Q26BJ, CO_niopiac1m, CO_autopiac1m, Q26AJ, NH_Q26AJnf, NMD_CO_iamph1m, NMD_Q27BJ, NMD_CO_niamph1m, NMD_COMD_fsautamph1m, NMD_Q27AJ, NMD_COMD_nfsaamph1m, NW_tranquiliv1m, NW_Q29BJ, NW_tranquiliv1m_fj, NW_tranquil1m, Q29AJ, NW_tranquil1m_fj, CO_mari1m, Q30AJ, NW_mari1m_fj, NW_psychiv1m, NW_Q31BJ, NW_psychiv1m_fj, NW_psych1m, Q31AJ, NW_psych1m_fj, NMD_NW_autmediv1m, NMD_NW_Q32BJ, NMD_NW_autmediv1m_fs,
NMD_NW_autmed1m, NMD_NW_Q32AJ, CO_iaut11m, NMD_NW_autmed1m_fs,CO_fsaut11m, NW_Q21C1)

```



```{r}
# Creating groups by age
new_data <- new_data %>% 
  mutate(
    # Create categories
    age_group = dplyr::case_when(
      age < 30 ~ "0-30",
      age >= 30 & age < 40 ~ "30-40",
      age >= 40 & age < 50 ~ "40-50",
      age >= 50 & age < 60 ~ "50-60",
      age >= 60 & age < 70 ~ "60-70",
      age >= 70            ~ ">=70"
    ),
    # Convert to factor
    age_group = factor(
      age_group,
      level = c("0-30","30-40", "40-50", "50-60", "60-70", ">=70")
    )
  )

table(new_data$age_group)

```


```{r}
# Creating groups by CO_njalc1

table(new_data$CO_njalc1)

new_data <- new_data %>% 
  mutate(
    # Create categories
    CO_njalc1_group = dplyr::case_when(
      CO_njalc1 == 0 ~ "0",
      CO_njalc1 >= 1 & CO_njalc1 <= 10 ~ "1-10",
      CO_njalc1 >= 11 & CO_njalc1 <= 20 ~ "11-20",
      CO_njalc1 >= 21 & CO_njalc1 <= 29 ~ "21-29",
      CO_njalc1 == 30 ~ "30"
    ),
    # Convert to factor
    CO_njalc1_group = factor(
      CO_njalc1_group,
      level = c("0","1-10", "11-20", "21-29", "30")
    )
  )

table(new_data$CO_njalc1_group)

```




# PART 1

```{r}
# Age summary
summarize(new_data, mean(age), median(age), IQR(age))

```
In this sample, the mean age is 49.47, the median is 49.87, and the interquartile range is 17.26.


```{r}
# grouping into genders
new_data.group.gender <- group_by(new_data, VBA3)

# Male vs Female median age 
summarize(new_data.group.gender, median(age), mean(age), IQR(age))

```
The following are descriptive statistics for men: 51.09 is the median, 50.38 is the mean, and 16.71 is the IQR, while for women: 43.43 is the median, 44.89 is the mean, and 14.13 is the IQR.


```{r}
# Age proportion from 40 years gender wise
men_greater_39 <- length(which(new_data.group.gender$age >= 40 & new_data.group.gender$VBA3 == 1))
men_less_40 <- length(which(new_data.group.gender$age < 40 & new_data.group.gender$VBA3 == 1))
women_greater_39 = length(which(new_data.group.gender$age >= 40 & new_data.group.gender$VBA3 == 2))
women_less_40 = length(which(new_data.group.gender$age < 40 & new_data.group.gender$VBA3 == 2))


r.men <- c(men_less_40, men_greater_39)
r.women <- c(women_less_40, women_greater_39)

r.df <- as.table(cbind(r.men, r.women))

dimnames(r.df) <- list(division_with_40 = c("less than 40", "greater than and equal to 40"),
                       gender = c("Men", "Women"))

r.df
```
There are 87 Men who are less than 40 and 365 men greater than and equal to 40. There are 28 Women who are less than 40 and 59 Women who are greater than and equal to 40.


```{r}
# Unstable housing 
table_unstabh_1mb <- table(new_data.group.gender$unstabh_1mb)
addmargins(table_unstabh_1mb)
addmargins(prop.table(table_unstabh_1mb))


# Unstable housing 
table_unstabh_1mb <- table(new_data.group.gender$unstabh_1mb)
addmargins(table_unstabh_1mb)
addmargins(prop.table(table_unstabh_1mb))

# incar_3m 
table_incar_3m <- table(new_data.group.gender$incar_3m)
addmargins(table_incar_3m)
addmargins(prop.table(table_incar_3m))

# CO_scolar 
table_CO_scolar <- table(new_data.group.gender$CO_scolar)
addmargins(table_CO_scolar)
addmargins(prop.table(table_CO_scolar))

# OAT 
table_OAT <- table(new_data.group.gender$OAT_3m)
addmargins(table_OAT)
addmargins(prop.table(table_OAT))

# cocaiv_pm
table_cocaiv_pm <- table(new_data.group.gender$cocaiv_pm)
addmargins(table_cocaiv_pm)
addmargins(prop.table(table_cocaiv_pm))

# heroiv_pm
table_heroiv_pm <- table(new_data.group.gender$heroiv_pm)
addmargins(table_heroiv_pm)
addmargins(prop.table(table_heroiv_pm))


# opiiv_pm
table_opiiv_pm <- table(new_data.group.gender$opiiv_pm)
addmargins(table_opiiv_pm)
addmargins(prop.table(table_opiiv_pm))

```



# PART 2

```{r}
new_data.group.cp.gender <- group_by(new_data, DrQ3, VBA3)


# Division of cp by age
table_cp_gender <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$VBA3)
addmargins(table_cp_gender)
addmargins(prop.table(table_cp_gender))

# Summary of chronic pain by age
new_data.group.cp.gender %>% summarise(mean_age = mean(age), median_age = median(age), iqr_age = IQR(age))

# division of cp by unstabh_1mb
table_cp_unstabh_1mb <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$unstabh_1mb)
addmargins(table_cp_unstabh_1mb)
addmargins(prop.table(table_cp_unstabh_1mb))

# division by cp and incar_3m
table_cp_incar_3m <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$incar_3m)
addmargins(table_cp_incar_3m)
addmargins(prop.table(table_cp_incar_3m))

# division by cp and CO_scolar
table_cp_CO_scolar <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$CO_scolar)
addmargins(table_cp_CO_scolar)
addmargins(prop.table(table_cp_CO_scolar))


# division by cp and OAT
table_cp_OAT <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$OAT_3m)
addmargins(table_cp_OAT)
addmargins(prop.table(table_cp_OAT))


# division by cp and cocaiv_pm
table_cp_cocaiv_pm <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$cocaiv_pm)
addmargins(table_cp_cocaiv_pm)
addmargins(prop.table(table_cp_cocaiv_pm))


# division by cp and heroiv_pm
table_cp_heroiv_pm <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$heroiv_pm)
addmargins(table_cp_heroiv_pm)
addmargins(prop.table(table_cp_heroiv_pm))


# division by cp and opiiv_pm
table_cp_opiiv_pm  <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$opiiv_pm)
addmargins(table_cp_opiiv_pm)
addmargins(prop.table(table_cp_opiiv_pm))

```
A total of 543 participants (median age of 45 years, 13.7% women) were included. The prevalence of chronic pain was 46% (n=252). 108/252 (n=43%) noted using alcohol, cannabis, or an illegal drug to help manage their chronic pain. A total of 87/252 (35%) participants were prescribed opioid (n=41, 47%) and/or non-opioid medications (n=59, 68%). 24% (n= 21) of participants reported using their prescribed medication at an increased dose or frequency than that recommended; 23% (n=20) of participants consumed their prescribed medication by a route different from the recommended mode of consumption; 23% (n=20) of participants reported using medication that was not prescribed to them to help manage their pain. Overall, prescribed pain medication was misused in at least one of the above manners by 30% of the participants who reported chronic pain (n=75).
Of the participants who received a chronic pain diagnosis (n=156, 62%), 32% (n=50) visited a physician in the last 3 months due to their pain, and 23/31 (74%) were prescribed pain medication when requested.



# PART 3

## Chi-square test for association (independence) tests

```{r}
# chi-sq for cp and age_group
table_cp_age_group <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$age_group)
(chisq_age_group <- chisq.test(table_cp_age_group))
chisq_age_group$observed
chisq_age_group$expected

chisq.posthoc.test(table_cp_age_group)
```

The p-value of the above ch-square test is < 0.1. Therefore it is statistically significant.


```{r}
# chi-sq for cp and age_40
table_cp_age_40 <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$age_40)
(chisq_age <- chisq.test(table_cp_age_40))
chisq_age$observed
chisq_age$expected

chisq.posthoc.test(table_cp_age_40)

```

The p-value of the above ch-square test is < 0.1. Therefore it is statistically significant.


```{r}
# Table for Age group and Alcohol frequency
(table_age_group_alchol_freq <- table(new_data.group.cp.gender$age_group, new_data.group.cp.gender$CO_njalc1_group))

(chisq_age_group_alchol_freq <- chisq.test(table_age_group_alchol_freq))
chisq_age_group_alchol_freq$observed
chisq_age_group_alchol_freq$expected

chisq.posthoc.test(table_age_group_alchol_freq)
```






The p-value of the above ch-square test is < 0.1. Therefore it is statistically significant.


```{r}
# chi-sq for cp and NW_Q21C1
table_cp_NW_Q21C1 <- table(new_data.group.cp.gender$DrQ3, new_data.group.cp.gender$NW_Q21C1)
(chisq_NW_Q21C1 <- chisq.test(table_cp_NW_Q21C1))
chisq_NW_Q21C1$observed
chisq_NW_Q21C1$expected

chisq.posthoc.test(table_cp_NW_Q21C1)


```
The p-value of the above ch-square test is < 0.1. Therefore it is statistically significant.



```{r}
# cp and alcohol frequency group (CO_njalc1_group)
(table_cp_alcohol_group <- table(new_data$DrQ3, new_data$CO_njalc1_group))
chisq.test(table_cp_alcohol_group)
(chisq_cp_alcohol_group <- chisq.test(table_cp_alcohol_group))
chisq_cp_alcohol_group$observed
chisq_cp_alcohol_group$expected


chisq.posthoc.test(table_cp_alcohol_group)
```
The p-value of the above ch-square test is < 0.1. Therefore it is statistically significant.


```{r}
# chisq for cp and Gender
(table_cp_VBA3 <- table(data$DrQ3, data$VBA3))
chisq.test(table_cp_VBA3)
chisq.posthoc.test(table_cp_VBA3)


# chi-sq for cp and unstabh_1mb
chisq.test(table_cp_unstabh_1mb)
chisq.posthoc.test(table_cp_unstabh_1mb)

# chi-sq for cp and incar_3m
chisq.test(table_cp_incar_3m)
chisq.posthoc.test(table_cp_incar_3m)

# chi-sq for cp and CO_scolar
chisq.test(table_cp_CO_scolar)
chisq.posthoc.test(table_cp_CO_scolar)

# chi-sq for cp and OAT_3m
chisq.test(new_data$DrQ3, new_data$OAT_3m)
chisq.posthoc.test(table_cp_OAT)

# chi-sq for cp and cocaiv
chisq.test(table_cp_cocaiv_pm)
chisq.posthoc.test(table_cp_cocaiv_pm)

# chi-sq for cp and heroiv_pm
chisq.test(table_cp_heroiv_pm)
chisq.posthoc.test(table_cp_heroiv_pm)

# chi-sq for cp and opiiv_pm 
chisq.test(table_cp_opiiv_pm)
chisq.posthoc.test(table_cp_opiiv_pm)


# cp and alcohol frequecy
(table_cp_alcohol <- table(new_data$DrQ3, new_data$CO_njalc1))
chisq.test(table_cp_alcohol)
chisq.posthoc.test(table_cp_alcohol)

# cp and CO_ihero1m (1=yes 2=no)
table_cp_CO_ihero1m <- table(new_data$DrQ3, new_data$CO_ihero1m)
chisq.test(table_cp_CO_ihero1m)
chisq.posthoc.test(table_cp_CO_ihero1m)


# cp and Q22AJ freq. 
table_cp_Q22AJ <- table(new_data$DrQ3, new_data$Q22AJ)
chisq.test(table_cp_Q22AJ)
chisq.posthoc.test(table_cp_Q22AJ)


# cp and COMD_nihero1m freq. 
table_cp_COMD_nihero1m <- table(new_data$DrQ3, new_data$COMD_nihero1m)
chisq.test(table_cp_COMD_nihero1m)
chisq.posthoc.test(table_cp_COMD_nihero1m)

# cp and COMD_fshero1m freq
table_cp_COMD_fshero1m <- table(new_data$DrQ3, new_data$COMD_fshero1m)
chisq.test(table_cp_COMD_fshero1m)
chisq.posthoc.test(table_cp_COMD_fshero1m)

# cp and Q22BJ freq
table_cp_Q22BJ <- table(new_data$DrQ3, new_data$Q22BJ)
chisq.test(table_cp_Q22BJ)
chisq.posthoc.test(table_cp_Q22BJ)


# cp and COMD_nfshero1m
table_cp_COMD_nfshero1m <- table(new_data$DrQ3, new_data$COMD_nfshero1m)
chisq.test(table_cp_COMD_nfshero1m)
chisq.posthoc.test(table_cp_COMD_nfshero1m)


# cp and CO_ipoud1m
table_cp_CO_ipoud1m <- table(new_data$DrQ3, new_data$CO_ipoud1m)
chisq.test(table_cp_CO_ipoud1m)
chisq.posthoc.test(table_cp_CO_ipoud1m)


# cp and MD_Q23AJ_1
table_cp_MD_Q23AJ_1 <- table(new_data$DrQ3, new_data$MD_Q23AJ_1)
chisq.test(table_cp_MD_Q23AJ_1)
chisq.posthoc.test(table_cp_MD_Q23AJ_1)


# cp and COMD_nicoke1m_p
table_cp_COMD_nicoke1m_p <- table(new_data$DrQ3, new_data$COMD_nicoke1m_p)
chisq.test(table_cp_COMD_nicoke1m_p)
chisq.posthoc.test(table_cp_COMD_nicoke1m_p)

# cp and CO_icrak1m
table_cp_CO_icrak1m <- table(new_data$DrQ3, new_data$CO_icrak1m)
chisq.test(table_cp_CO_icrak1m)
chisq.posthoc.test(table_cp_CO_icrak1m)


# cp and MD_Q23AJ_2
table_cp_MD_Q23AJ_2 <- table(new_data$DrQ3, new_data$MD_Q23AJ_2)
chisq.test(table_cp_MD_Q23AJ_2)
chisq.posthoc.test(table_cp_MD_Q23AJ_2)


# cp and COMD_nicoke1m_c
table_cp_COMD_nicoke1m_c <- table(new_data$DrQ3, new_data$COMD_nicoke1m_c)
chisq.test(table_cp_COMD_nicoke1m_c)
chisq.posthoc.test(table_cp_COMD_nicoke1m_c)


# cp and CO_fpoud1m
table_cp_CO_fpoud1m <- table(new_data$DrQ3, new_data$CO_fpoud1m)
chisq.test(table_cp_CO_fpoud1m)
chisq.posthoc.test(table_cp_CO_fpoud1m)


# cp and MD_Q23BJ_1
table_cp_MD_Q23BJ_1 <- table(new_data$DrQ3, new_data$MD_Q23BJ_1)
chisq.test(table_cp_MD_Q23BJ_1)
chisq.posthoc.test(table_cp_MD_Q23BJ_1)


# cp and COMD_nfcoke1m_p
table_cp_COMD_nfcoke1m_p <- table(new_data$DrQ3, new_data$COMD_nfcoke1m_p)
chisq.test(table_cp_COMD_nfcoke1m_p)
chisq.posthoc.test(table_cp_COMD_nfcoke1m_p)


# cp and COMD_fcrakfree1m
table_cp_COMD_fcrakfree1m <- table(new_data$DrQ3, new_data$COMD_fcrakfree1m)
chisq.test(table_cp_COMD_fcrakfree1m)
chisq.posthoc.test(table_cp_COMD_fcrakfree1m)


# cp and MD_Q23BJ_2
table_cp_MD_Q23BJ_2 <- table(new_data$DrQ3, new_data$MD_Q23BJ_2)
chisq.test(table_cp_MD_Q23BJ_2)
chisq.posthoc.test(table_cp_MD_Q23BJ_2)


# cp and COMD_nfcoke1m_cf
table_cp_COMD_nfcoke1m_cf <- table(new_data$DrQ3, new_data$COMD_nfcoke1m_cf)
chisq.test(table_cp_COMD_nfcoke1m_cf)
chisq.posthoc.test(table_cp_COMD_nfcoke1m_cf)


# cp and CO_scoke1m
table_cp_CO_scoke1m <- table(new_data$DrQ3, new_data$CO_scoke1m)
chisq.test(table_cp_CO_scoke1m)
chisq.posthoc.test(table_cp_CO_scoke1m)


# cp and Q23CJ
table_cp_Q23CJ <- table(new_data$DrQ3, new_data$Q23CJ)
chisq.test(table_cp_Q23CJ)
chisq.posthoc.test(table_cp_Q23CJ)

# cp and COMD_nscoke1m
table_cp_COMD_nscoke1m <- table(new_data$DrQ3, new_data$COMD_nscoke1m)
chisq.test(table_cp_COMD_nscoke1m)
chisq.posthoc.test(table_cp_COMD_nscoke1m)


# cp and CO_ispeed1m
table_cp_CO_ispeed1m <- table(new_data$DrQ3, new_data$CO_ispeed1m)
chisq.test(table_cp_CO_ispeed1m)
chisq.posthoc.test(table_cp_CO_ispeed1m)


# cp and Q2223AJ
table_cp_Q2223AJ <- table(new_data$DrQ3, new_data$Q2223AJ)
chisq.test(table_cp_Q2223AJ)
chisq.posthoc.test(table_cp_Q2223AJ)

# cp and COMD_nispeed1m
table_cp_COMD_nispeed1m <- table(new_data$DrQ3, new_data$COMD_nispeed1m)
chisq.test(table_cp_COMD_nispeed1m)
chisq.posthoc.test(table_cp_COMD_nispeed1m)


# cp and NH_Q7Ia_suboxIV
table_cp_NH_Q7Ia_suboxIV <- table(new_data$DrQ3, new_data$NH_Q7Ia_suboxIV)
chisq.test(table_cp_NH_Q7Ia_suboxIV)
chisq.posthoc.test(table_cp_NH_Q7Ia_suboxIV)


# cp and NH_Q7Ia_suboxIVj
table_cp_NH_Q7Ia_suboxIVj <- table(new_data$DrQ3, new_data$NH_Q7Ia_suboxIVj)
chisq.test(table_cp_NH_Q7Ia_suboxIVj)
chisq.posthoc.test(table_cp_NH_Q7Ia_suboxIVj)


# cp and NH_Q7Ib_subox
table_cp_NH_Q7Ib_subox <- table(new_data$DrQ3, new_data$NH_Q7Ib_subox)
chisq.test(table_cp_NH_Q7Ib_subox)
chisq.posthoc.test(table_cp_NH_Q7Ib_subox)


# cp and NH_Q7Ib_suboxj
table_cp_NH_Q7Ib_suboxj <- table(new_data$DrQ3, new_data$NH_Q7Ib_suboxj)
chisq.test(table_cp_NH_Q7Ib_suboxj)
chisq.posthoc.test(table_cp_NH_Q7Ib_suboxj)


# cp and NH_Q7Ja_methaIV
table_cp_NH_Q7Ja_methaIV <- table(new_data$DrQ3, new_data$NH_Q7Ja_methaIV)
chisq.test(table_cp_NH_Q7Ja_methaIV)
chisq.posthoc.test(table_cp_NH_Q7Ja_methaIV)


# cp and NH_Q7Ja_methaIVj
table_cp_NH_Q7Ja_methaIVj <- table(new_data$DrQ3, new_data$NH_Q7Ja_methaIVj)
chisq.test(table_cp_NH_Q7Ja_methaIVj)
chisq.posthoc.test(table_cp_NH_Q7Ja_methaIVj)


# cp and NH_Q7Jb_metha
table_cp_NH_Q7Jb_metha <- table(new_data$DrQ3, new_data$NH_Q7Jb_metha)
chisq.test(table_cp_NH_Q7Jb_metha)
chisq.posthoc.test(table_cp_NH_Q7Jb_metha)


# cp and NH_Q7Jb_methaj
table_cp_NH_Q7Jb_methaj <- table(new_data$DrQ3, new_data$NH_Q7Jb_methaj)
chisq.test(table_cp_NH_Q7Jb_methaj)
chisq.posthoc.test(table_cp_NH_Q7Jb_methaj)

# cp and CO_iopiac1m
table_cp_CO_iopiac1m <- table(new_data$DrQ3, new_data$CO_iopiac1m)
chisq.test(table_cp_CO_iopiac1m)
chisq.posthoc.test(table_cp_CO_iopiac1m)

# cp and Q26BJ
table_cp_Q26BJ <- table(new_data$DrQ3, new_data$Q26BJ)
chisq.test(table_cp_Q26BJ)
chisq.posthoc.test(table_cp_Q26BJ)

# cp and CO_niopiac1m
table_cp_CO_niopiac1m <- table(new_data$DrQ3, new_data$CO_niopiac1m)
chisq.test(table_cp_CO_niopiac1m)
chisq.posthoc.test(table_cp_CO_niopiac1m)

# cp and CO_autopiac1m
table_cp_CO_autopiac1m <- table(new_data$DrQ3, new_data$CO_autopiac1m)
chisq.test(table_cp_CO_autopiac1m)
chisq.posthoc.test(table_cp_CO_autopiac1m)

# cp and Q26AJ
table_cp_Q26AJ <- table(new_data$DrQ3, new_data$Q26AJ)
chisq.test(table_cp_Q26AJ)
chisq.posthoc.test(table_cp_Q26AJ)

# cp and NH_Q26AJnf
table_cp_NH_Q26AJnf <- table(new_data$DrQ3, new_data$NH_Q26AJnf)
chisq.test(table_cp_NH_Q26AJnf)
chisq.posthoc.test(table_cp_NH_Q26AJnf)

# cp and NMD_CO_iamph1m
table_cp_NMD_CO_iamph1m <- table(new_data$DrQ3, new_data$NMD_CO_iamph1m)
chisq.test(table_cp_NMD_CO_iamph1m)
chisq.posthoc.test(table_cp_NMD_CO_iamph1m)

# cp and NMD_Q27BJ
table_cp_NMD_Q27BJ <- table(new_data$DrQ3, new_data$NMD_Q27BJ)
chisq.test(table_cp_NMD_Q27BJ)
chisq.posthoc.test(table_cp_NMD_Q27BJ)

# cp and NMD_CO_niamph1m
table_cp_NMD_CO_niamph1m <- table(new_data$DrQ3, new_data$NMD_CO_niamph1m)
chisq.test(table_cp_NMD_CO_niamph1m)
chisq.posthoc.test(table_cp_NMD_CO_niamph1m)

# cp and NMD_COMD_fsautamph1m
table_cp_NMD_COMD_fsautamph1m <- table(new_data$DrQ3, new_data$NMD_COMD_fsautamph1m)
chisq.test(table_cp_NMD_COMD_fsautamph1m)
chisq.posthoc.test(table_cp_NMD_COMD_fsautamph1m)

# cp and NMD_Q27AJ
table_cp_NMD_Q27AJ <- table(new_data$DrQ3, new_data$NMD_Q27AJ)
chisq.test(table_cp_NMD_Q27AJ)
chisq.posthoc.test(table_cp_NMD_Q27AJ)

# cp and NMD_COMD_nfsaamph1m
table_cp_NMD_COMD_nfsaamph1m <- table(new_data$DrQ3, new_data$NMD_COMD_nfsaamph1m)
chisq.test(table_cp_NMD_COMD_nfsaamph1m)
chisq.posthoc.test(table_cp_NMD_COMD_nfsaamph1m)

# cp and NW_tranquiliv1m
table_cp_NW_tranquiliv1m <- table(new_data$DrQ3, new_data$NW_tranquiliv1m)
chisq.test(table_cp_NW_tranquiliv1m)
chisq.posthoc.test(table_cp_NW_tranquiliv1m)

# cp and NW_Q29BJ
table_cp_NW_Q29BJ <- table(new_data$DrQ3, new_data$NW_Q29BJ)
chisq.test(table_cp_NW_Q29BJ)
chisq.posthoc.test(table_cp_NW_Q29BJ)

# cp and NW_tranquiliv1m_fj
table_cp_NW_tranquiliv1m_fj <- table(new_data$DrQ3, new_data$NW_tranquiliv1m_fj)
chisq.test(table_cp_NW_tranquiliv1m_fj)
chisq.posthoc.test(table_cp_NW_tranquiliv1m_fj)

# cp and NW_tranquil1m
table_cp_NW_tranquil1m <- table(new_data$DrQ3, new_data$NW_tranquil1m)
chisq.test(table_cp_NW_tranquil1m)
chisq.posthoc.test(table_cp_NW_tranquil1m)

# cp and Q29AJ
table_cp_Q29AJ <- table(new_data$DrQ3, new_data$Q29AJ)
chisq.test(table_cp_Q29AJ)
chisq.posthoc.test(table_cp_Q29AJ)

# cp and NW_tranquil1m_fj
table_cp_NW_tranquil1m_fj <- table(new_data$DrQ3, new_data$NW_tranquil1m_fj)
chisq.test(table_cp_NW_tranquil1m_fj)
chisq.posthoc.test(table_cp_NW_tranquil1m_fj)

# cp and CO_mari1m
table_cp_CO_mari1m <- table(new_data$DrQ3, new_data$CO_mari1m)
chisq.test(table_cp_CO_mari1m)
chisq.posthoc.test(table_cp_CO_mari1m)

# cp and Q30AJ
table_cp_Q30AJ <- table(new_data$DrQ3, new_data$Q30AJ)
chisq.test(table_cp_Q30AJ)
chisq.posthoc.test(table_cp_Q30AJ)

# cp and NW_mari1m_fj
table_cp_NW_mari1m_fj <- table(new_data$DrQ3, new_data$NW_mari1m_fj)
chisq.test(table_cp_NW_mari1m_fj)
chisq.posthoc.test(table_cp_NW_mari1m_fj)

# cp and NMD_NW_autmediv1m
table_cp_NMD_NW_autmediv1m <- table(new_data$DrQ3, new_data$NMD_NW_autmediv1m)
chisq.test(table_cp_NMD_NW_autmediv1m)
chisq.posthoc.test(table_cp_NMD_NW_autmediv1m)

# cp and NMD_NW_Q32BJ
table_cp_NMD_NW_Q32BJ <- table(new_data$DrQ3, new_data$NMD_NW_Q32BJ)
chisq.test(table_cp_NMD_NW_Q32BJ)
chisq.posthoc.test(table_cp_NMD_NW_Q32BJ)

# cp and NMD_NW_autmediv1m_fs
table_cp_NMD_NW_autmediv1m_fs <- table(new_data$DrQ3, new_data$NMD_NW_autmediv1m_fs)
chisq.test(table_cp_NMD_NW_autmediv1m_fs)
chisq.posthoc.test(table_cp_NMD_NW_autmediv1m_fs)

# cp and NMD_NW_autmed1m
table_cp_NMD_NW_autmed1m <- table(new_data$DrQ3, new_data$NMD_NW_autmed1m)
chisq.test(table_cp_NMD_NW_autmed1m)
chisq.posthoc.test(table_cp_NMD_NW_autmed1m)

# cp and NMD_NW_Q32AJ
table_cp_NMD_NW_Q32AJ <- table(new_data$DrQ3, new_data$NMD_NW_Q32AJ)
chisq.test(table_cp_NMD_NW_Q32AJ)
chisq.posthoc.test(table_cp_NMD_NW_Q32AJ)

# cp and NMD_NW_autmed1m_fs
table_cp_NMD_NW_autmed1m_fs <- table(new_data$DrQ3, new_data$NMD_NW_autmed1m_fs)
chisq.test(table_cp_NMD_NW_autmed1m_fs)
chisq.posthoc.test(table_cp_NMD_NW_autmed1m_fs)
```

As the p-Value of this test is high (greater than 0.1), so, we failed to reject the null hypothesis. So, from the chi-squared test, it is evident that the variables are independent of each other.


#  Training and Test Division


```{r}

set.seed(1) # Set Seed so that same sample can be reproduced in future also
# Now Selecting 75% of data as sample from total 'n' rows of the data  
sample <- sample.int(n = nrow(new_data), size = floor(.75*nrow(new_data)), replace = F)
TrainingSet <- new_data[sample, ]
TestingSet  <- new_data[-sample, ]

```

Dividing our sample into training (75 %) and testing (25%).

# Univariate Logistic regression

```{r}
Model_age_group <- glm(DrQ3 ~  age_group, family = binomial, data = new_data)
summary(Model_age_group)


# exponentiate the coefficients (Odds ratio)
exp(coef(Model_age_group))
# 95% CI (odds ratio)
exp(confint(Model_age_group))
```
Here, p value is less than 0.1 for groups like age_group<=30, age_group40-50, age_group50-60, age_group60-70, age_group>=70, therefore it is statistically significant.


```{r}
Model_age_40 <- glm(DrQ3 ~  age_40, family = binomial, data = new_data)
summary(Model_age_40)


# exponentiate the coefficients (Odds ratio)
exp(coef(Model_age_40))
# 95% CI (odds ratio)
exp(confint(Model_age_40))
```

Here, p-value < 0.05, therefore the above features turns out to be significant.

```{r}

Model_unstabh_1mb <- glm(DrQ3 ~ unstabh_1mb , family = binomial, data = new_data)
summary(Model_unstabh_1mb)

exp(coef(Model_unstabh_1mb))
exp(confint(Model_unstabh_1mb))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_OAT_3m <- glm(DrQ3 ~ OAT_3m -1, family = binomial, data = new_data)
summary(Model_OAT_3m)

exp(coef(Model_OAT_3m))
exp(confint(Model_OAT_3m))
```

Here, p-value > 0.05, therefore the above features turns out to be insignificant. But, the value of intercept is significant as p < 0.05.

```{r}
Model_incar_3m <- glm(DrQ3 ~ incar_3m , family = binomial, data = new_data)
summary(Model_incar_3m)

exp(coef(Model_incar_3m))
exp(confint(Model_incar_3m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant. But, the value of intercept is significant as p ~<= 0.05.

```{r}
Model_opiiv_pm <- glm(DrQ3 ~ opiiv_pm , family = binomial, data = new_data)
summary(Model_opiiv_pm)

exp(coef(Model_opiiv_pm))
exp(confint(Model_opiiv_pm))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
Model_heroiv_pm <- glm(DrQ3 ~ heroiv_pm , family = binomial, data = new_data)
summary(Model_heroiv_pm)

exp(coef(Model_heroiv_pm))
exp(confint(Model_heroiv_pm))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_cocaiv_pm <- glm(DrQ3 ~ cocaiv_pm , family = binomial, data = new_data)
summary(Model_cocaiv_pm)

exp(coef(Model_cocaiv_pm))
exp(confint(Model_cocaiv_pm))
```

Here, p-value > 0.05, therefore the above features turns out to be insignificant.



```{r warning=FALSE}
Model_CO_fsaut11m <- glm(DrQ3 ~ CO_fsaut11m , family = binomial, data = new_data)
summary(Model_CO_fsaut11m)

exp(coef(Model_CO_fsaut11m))
exp(confint(Model_CO_fsaut11m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r warning=FALSE}
Model_CO_iaut11m <- glm(DrQ3 ~ CO_iaut11m , family = binomial, data = new_data)
summary(Model_CO_iaut11m)

exp(coef(Model_CO_iaut11m))
exp(confint(Model_CO_iaut11m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
Model_NMD_NW_autmed1m <- glm(DrQ3 ~ NMD_NW_autmed1m , family = binomial, data = new_data)
summary(Model_NMD_NW_autmed1m)

exp(coef(Model_NMD_NW_autmed1m))
exp(confint(Model_NMD_NW_autmed1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
Model_NMD_NW_autmediv1m <- glm(DrQ3 ~ NMD_NW_autmediv1m , family = binomial, data = new_data)
summary(Model_NMD_NW_autmediv1m)

exp(coef(Model_NMD_NW_autmediv1m))
exp(confint(Model_NMD_NW_autmediv1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NW_psych1m <- glm(DrQ3 ~ NW_psych1m , family = binomial, data = new_data)
summary(Model_NW_psych1m)

exp(coef(Model_NW_psych1m))
exp(confint(Model_NW_psych1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
Model_NW_psychiv1m <- glm(DrQ3 ~ NW_psychiv1m , family = binomial, data = new_data)
summary(Model_NW_psychiv1m)

exp(coef(Model_NW_psychiv1m))
exp(confint(Model_NW_psychiv1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_mari1m <- glm(DrQ3 ~ CO_mari1m , family = binomial, data = new_data)
summary(Model_CO_mari1m)

exp(coef(Model_CO_mari1m))
exp(confint(Model_CO_mari1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NW_tranquil1m <- glm(DrQ3 ~ NW_tranquil1m , family = binomial, data = new_data)
summary(Model_NW_tranquil1m)

exp(coef(Model_NW_tranquil1m))
exp(confint(Model_NW_tranquil1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NW_tranquiliv1m <- glm(DrQ3 ~ NW_tranquiliv1m , family = binomial, data = new_data)
summary(Model_NW_tranquiliv1m)

exp(coef(Model_NW_tranquiliv1m))
exp(confint(Model_NW_tranquiliv1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NMD_COMD_fsautamph1m <- glm(DrQ3 ~ NMD_COMD_fsautamph1m , family = binomial, data = new_data)
summary(Model_NMD_COMD_fsautamph1m)

exp(coef(Model_NMD_COMD_fsautamph1m))
exp(confint(Model_NMD_COMD_fsautamph1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NMD_CO_iamph1m <- glm(DrQ3 ~ NMD_CO_iamph1m , family = binomial, data = new_data)
summary(Model_NMD_CO_iamph1m)

exp(coef(Model_NMD_CO_iamph1m))
exp(confint(Model_NMD_CO_iamph1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_autopiac1m <- glm(DrQ3 ~ CO_autopiac1m , family = binomial, data = new_data)
summary(Model_CO_autopiac1m)

exp(coef(Model_CO_autopiac1m))
exp(confint(Model_CO_autopiac1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_NH_Q7Jb_metha <- glm(DrQ3 ~ NH_Q7Jb_metha , family = binomial, data = new_data)
summary(Model_NH_Q7Jb_metha)

exp(coef(Model_NH_Q7Jb_metha))
exp(confint(Model_NH_Q7Jb_metha))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r warning=FALSE}
Model_NH_Q7Ib_subox <- glm(DrQ3 ~ NH_Q7Ib_subox , family = binomial, data = new_data)
summary(Model_NH_Q7Ib_subox)

exp(coef(Model_NH_Q7Ib_subox))
exp(confint(Model_NH_Q7Ib_subox))

```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r warning=FALSE}
Model_NH_Q7Ia_suboxIV <- glm(DrQ3 ~ NH_Q7Ia_suboxIV , family = binomial, data = new_data)
summary(Model_NH_Q7Ia_suboxIV)

exp(coef(Model_NH_Q7Ia_suboxIV))
exp(confint(Model_NH_Q7Ia_suboxIV))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_COMD_nispeed1m <- glm(DrQ3 ~ COMD_nispeed1m , family = binomial, data = new_data)
summary(Model_COMD_nispeed1m)

exp(coef(Model_COMD_nispeed1m))
exp(confint(Model_COMD_nispeed1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_ispeed1m <- glm(DrQ3 ~ CO_ispeed1m , family = binomial, data = new_data)
summary(Model_CO_ispeed1m)

exp(coef(Model_CO_ispeed1m))
exp(confint(Model_CO_ispeed1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_COMD_fcrakfree1m <- glm(DrQ3 ~ COMD_fcrakfree1m , family = binomial, data = new_data)
summary(Model_COMD_fcrakfree1m)

exp(coef(Model_COMD_fcrakfree1m))
exp(confint(Model_COMD_fcrakfree1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_fpoud1m <- glm(DrQ3 ~ CO_fpoud1m , family = binomial, data = new_data)
summary(Model_CO_fpoud1m)

exp(coef(Model_CO_fpoud1m))
exp(confint(Model_CO_fpoud1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_icrak1m <- glm(DrQ3 ~ CO_icrak1m , family = binomial, data = new_data)
summary(Model_CO_icrak1m)

exp(coef(Model_CO_icrak1m))
exp(confint(Model_CO_icrak1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r}
Model_CO_ipoud1m <- glm(DrQ3 ~ CO_ipoud1m , family = binomial, data = new_data)
summary(Model_CO_ipoud1m)

exp(coef(Model_CO_ipoud1m))
exp(confint(Model_CO_ipoud1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant. But, the value of intercept is significant as p ~<= 0.01


```{r}
Model_COMD_fshero1m <- glm(DrQ3 ~ COMD_fshero1m , family = binomial, data = new_data)
summary(Model_COMD_fshero1m)

exp(coef(Model_COMD_fshero1m))
exp(confint(Model_COMD_fshero1m))
```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
Model_CO_ihero1m <- glm(DrQ3 ~ CO_ihero1m , family = binomial, data = new_data)
summary(Model_CO_ihero1m)

exp(coef(Model_CO_ihero1m))
exp(confint(Model_CO_ihero1m))
```

Here, p-value > 0.05, therefore the above features turns out to be insignificant.



```{r}
# NW_Q21C1

Model_NW_Q21C1 <- glm(DrQ3 ~ NW_Q21C1 -1, family = binomial, data = new_data)
summary(Model_NW_Q21C1)

exp(coef(Model_NW_Q21C1))
exp(confint(Model_NW_Q21C1))


```
Here, p-value < 0.1, therefore the above features i.e NW_Q21C12 turns out to be significant.



```{r}
Model_CO_njalc1 <- glm(DrQ3 ~ CO_njalc1 , family = binomial, data = new_data)
summary(Model_CO_njalc1)

exp(coef(Model_CO_njalc1))
exp(confint(Model_CO_njalc1))
```
Here, p-value < 0.05, therefore the above features turns out to be significant.



```{r}
Model_CO_njalc1_group <- glm(DrQ3 ~ CO_njalc1_group , family = binomial, data = new_data)
summary(Model_CO_njalc1_group)

exp(coef(Model_CO_njalc1_group))
exp(confint(Model_CO_njalc1_group))
```
Here, p-value < 0.1, therefore the above features turns out to be significant. Here intercept i.e CO_njalc1_group (0), CO_njalc1_group (11-20), CO_njalc1_group (21-29) are significant as there p < 0.1.



```{r}
Model_NW_jourcons <- glm(DrQ3 ~ NW_jourcons , family = binomial, data = new_data)
summary(Model_NW_jourcons)

exp(coef(Model_NW_jourcons))

exp(confint(Model_NW_jourcons))
```

Here, p-value > 0.05, therefore the above features turns out to be insignificant.


```{r}
(Model_VBA3 <- glm(DrQ3 ~ VBA3 , family = binomial, data = new_data))
summary(Model_VBA3)

exp(coef(Model_VBA3))

exp(confint(Model_VBA3))
```

Here, p-value > 0.05, therefore the above features turns out to be insignificant.

```{r warning=FALSE}
Model_CO_scolar <- glm(DrQ3 ~ CO_scolar , family = binomial, data = new_data)
summary(Model_CO_scolar)
exp(coef(Model_CO_scolar))

exp(confint(Model_CO_scolar))

```
Here, p-value > 0.05, therefore the above features turns out to be insignificant.

We found age_group, age_40, CO_njalc1_group, NW_Q21C1 features as statistically significant in chi-square tests for independence.

The above univariate logistic regression shows that variables age_40, age_group, CO_njalc1, CO_njalc1_group, NW_Q21C12 are statistically significant, and for OAT_3m, CO_ipoud1m, and incar_3m there were statistically significant intercepts only, so will include them for further research. These features will be used in multivariate logistic regression.

We will not include NW_Q21C12 as it has two values (1 - Yes, drink alcohol and 2 - No, do not drink alcohol) which is already covered in CO_njalc1_group as group 0 covers all samples who do not drink achohol and remaining other groups drink alcohol. 


# Multivaraite logistic regression

## CASE 1:

Performing multivariate logistic regression on:  
age_40, CO_njalc1_group, OAT_3m, CO_ipoud1m and incar_3m

### MODEL 1:

```{r}
Model_multivariate <- glm(DrQ3 ~ age_40 +  CO_njalc1_group + OAT_3m +  CO_ipoud1m + incar_3m, family = binomial, data = TrainingSet)

summary(Model_multivariate)


tr_prob_1 <- predict(Model_multivariate, newdata = TrainingSet, type = "response")

tr_pred_1 <- ifelse(tr_prob_1 > 0.5, "Yes", "No")
tr_acc_1 <- mean(tr_pred_1 == TrainingSet$DrQ3)

test_prob_1 <- predict(Model_multivariate, newdata = TestingSet, type = "response")
test_pred_1 <- ifelse(test_prob_1 > 0.5, "Yes", "No")
test_acc_1 <- mean(test_pred_1 == TestingSet$DrQ3)


cat("Model 1 Training Accuracy:   ", tr_acc_1, "\n",
    "Model 1 Validation Accuracy: ", test_acc_1, "\n\n"
)


```

```{r}
exp(coef(Model_multivariate))

exp(confint(Model_multivariate))
```



From the output above, the coefficients table shows the beta coefficient estimates and their significance levels. Columns are:  

1. Estimate: the intercept (b0) and the beta coefficient estimates associated to each predictor variable  
2. Std.Error: the standard error of the coefficient estimates. This represents the accuracy of the coefficients. The larger the standard error, the less confident we are about the estimate.  
3. z value: the z-statistic, which is the coefficient estimate (column 2) divided by the standard error of the estimate (column 3)  
4. Pr(>|z|): The p-value corresponding to the z-statistic. The smaller the p-value, the more significant the estimate is.  


It can be seen that only few predictors are significantly associated to the outcome. These include: age_400, age_401, CO_njalc1_group11-20, CO_njalc1_group21-29, OAT_3m1. To avoid over fitting we will remove the worst performing features i.e. OAT_3m, incar_3m and CO_ipoud1m and try again.


### MODEL 2:
```{r}
Model_multivariate_1 <- glm(DrQ3 ~ age_40 +  CO_njalc1_group, family = binomial, data = TrainingSet)

summary(Model_multivariate_1)


tr_prob_1 <- predict(Model_multivariate_1, newdata = TrainingSet, type = "response")

tr_pred_1 <- ifelse(tr_prob_1 > 0.5, "Yes", "No")
tr_acc_1 <- mean(tr_pred_1 == TrainingSet$DrQ3)

test_prob_1 <- predict(Model_multivariate_1, newdata = TestingSet, type = "response")
test_pred_1 <- ifelse(test_prob_1 > 0.5, "Yes", "No")
test_acc_1 <- mean(test_pred_1 == TestingSet$DrQ3)


cat("Model 2 Training Accuracy:   ", tr_acc_1, "\n",
    "Model 2 Validation Accuracy: ", test_acc_1, "\n\n"
)


```


```{r}
exp(coef(Model_multivariate_1))

exp(confint(Model_multivariate_1))
```






## CASE 2:
Performing multivariate logistic regression on:  
age_group, CO_njalc1_group, OAT_3m, CO_ipoud1m and incar_3m

### MODEL 3
```{r}
Model_multivariate_2 <- glm(DrQ3 ~ age_group +  CO_njalc1_group + OAT_3m +  CO_ipoud1m + incar_3m, family = binomial, data = TrainingSet)

summary(Model_multivariate_2)


tr_prob_1 <- predict(Model_multivariate_2, newdata = TrainingSet, type = "response")

tr_pred_1 <- ifelse(tr_prob_1 > 0.5, "Yes", "No")
tr_acc_1 <- mean(tr_pred_1 == TrainingSet$DrQ3)

test_prob_1 <- predict(Model_multivariate_2, newdata = TestingSet, type = "response")
test_pred_1 <- ifelse(test_prob_1 > 0.5, "Yes", "No")
test_acc_1 <- mean(test_pred_1 == TestingSet$DrQ3)


cat("Model 3 Training Accuracy:   ", tr_acc_1, "\n",
    "Model 3 Validation Accuracy: ", test_acc_1, "\n\n"
)


```

```{r}
exp(coef(Model_multivariate_2))

exp(confint(Model_multivariate_2))
```

Again we see only few predictors are significantly associated to the outcome. These include: age_group0-30, age_group40-50, age_group50-60, age_group60-70, CO_njalc1_group11-20, CO_njalc1_group21-29 To avoid over fitting we will remove the worst performing features i.e. incar_3m, OAT_3m and CO_ipoud1m and try again.

### MODEL 4:

```{r}
Model_multivariate_3 <- glm(DrQ3 ~ age_group +  CO_njalc1_group, family = binomial, data = TrainingSet)


summary(Model_multivariate_3)

probabilities <- predict(Model_multivariate_3,
                       newdata = TestingSet,
                       type = "response")


tr_prob_1 <- predict(Model_multivariate_3,
                       newdata = TrainingSet,
                       type = "response")

tr_pred_1 <- ifelse(tr_prob_1 > 0.5, "Yes", "No")
tr_acc_1 <- mean(tr_pred_1 == TrainingSet$DrQ3)

test_prob_1 <- predict(Model_multivariate_3, newdata = TestingSet, type = "response")
test_pred_1 <- ifelse(test_prob_1 > 0.5, "Yes", "No")
test_acc_1 <- mean(test_pred_1 == TestingSet$DrQ3)


cat("Model 4 Training Accuracy:   ", tr_acc_1, "\n",
    "Model 4 Validation Accuracy: ", test_acc_1, "\n\n"
)

```


```{r}
exp(coef(Model_multivariate_3))

exp(confint(Model_multivariate_3))
```
Here, age_group0-30, age_group40-50, age_group50-60, age_group60-70, age_group>=70, CO_njalc1_group11-20, CO_njalc1_group21-29, OAT_3m are statistically significant as there p < 0.1.



Model 1 Training Accuracy:    0.5965347 
Model 1 Validation Accuracy:  0.5555556  

Model 2 Training Accuracy:    0.5742574 
Model 2 Validation Accuracy:  0.5333333 

Model 3 Training Accuracy:    0.5990099 
Model 3 Validation Accuracy:  0.5037037  

Model 4 Training Accuracy:    0.5816832 
Model 4 Validation Accuracy:  0.4666667  


## Model 2 Interpretation

The odds of the patient having chronic pain decreased by e^(0.834992) = 0.4338778 times for each additional patient under age of 40, whilst controlling for every other variable. 

The odds of the patient having chronic pain increased by e^(0.675688) = 1.9653853 times for each additional patient over age of 40, whilst controlling for every other variable.  

The odds of the patient having chronic pain increased by e^(0.731250) = 2.0776761 times for each additional patient CO_njalc1_group11-20, whilst controlling for every other variable.  

The odds of the patient having chronic pain increased by e^(1.048719) = 2.8539938 times for each additional patient in CO_njalc1_group21-29, whilst controlling for every other variable.  


## Model 4 Interpretation

The odds of the patient having chronic pain decreased by e^(1.18339) = 0.3062401 times for each additional patient under age of 30, whilst controlling for every other variable. 

The odds of the patient having chronic pain increased by e^(1.21686) = 3.3765771 times for each additional patient in age group of 50-60, whilst controlling for every other variable.  

The odds of the patient having chronic pain increased by e^(0.72656) = 2.0679545 times for each additional patient CO_njalc1_group11-20, whilst controlling for every other variable.  

The odds of the patient having chronic pain increased by e^(1.08110) = 2.9479310 times for each additional patient in CO_njalc1_group21-29, whilst controlling for every other variable.  



Model 1 has the highest accuracy on the validation set of 55.5 percentage but it also has some insignificant features. Therefore, we will choose Model 2 which has only significant features with the second highest accuracy on validation dataset as 53.3 percentage.  

Not considering model 4 as it has the lowest accuracy of 46.6 percentage.  
